# https://taskfile.dev

version: "3"

tasks:
  prepare:
    cmds:
      - npx -y mustache config/{{.ENV}}.json substreams.template.yaml > substreams.yaml

  prepare:dev:
    cmds:
      - task: prepare
        vars:
          ENV: dev

  proto:
    cmds:
      - substreams protogen ./substreams.yaml --exclude-paths="sf/substreams,google"

  build:
    cmds:
      - cargo build --release --target wasm32-unknown-unknown

  pack:
    cmds:
      - substreams pack ./substreams.yaml

  roll:dev:
    cmds:
      - task: prepare:dev
      - task: proto
      - task: build
      - task: pack